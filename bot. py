import os
import telebot
from db import init_db, add_payment
from paynet_client import create_invoice

TOKEN = os.getenv("7215798228:AAEDQ1GvwvhWGQufK6Crpcx6p6gdEnUJOMs")
ADMIN_ID = int(os.getenv("8194990004", 0))

bot = telebot.TeleBot(TOKEN)
init_db()

@bot.message_handler(commands=['start'])
def start(msg):
    bot.reply_to(msg, "Salom! Bu Paynet orqali to‘lov bot. Misol uchun: /pay 1000")

@bot.message_handler(commands=['pay'])
def pay(msg):
    try:
        amount = int(msg.text.split()[1])
        invoice = create_invoice(amount, msg.from_user.id)
        add_payment(msg.from_user.id, amount, invoice['id'], "pending")
        bot.reply_to(msg, f"To‘lov yaratildi: {invoice['link']}")
    except Exception as e:
        bot.reply_to(msg, f"Xatolik: {e}")

bot.polling()
